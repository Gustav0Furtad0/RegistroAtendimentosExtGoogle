<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRANET - TI Atendimentos</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div id="header">

    </div> 

    <div id="main">

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="./js/script.js"></script>
    <script>
        $(window).on("load", () => {
            $("#header").load("./html/header.html");
            carregapag()
        });

        function carregapag (link = 'atendimentos') {
            $("#main").load(`./html/${link}.html`, () => {
                if (link == 'atendimentos') {
                    carregaAtendimentos();
                };
            });
        };

        function carregaAtendimentos (...paramsBusca) {
            $.ajax({
                method: "GET",
                url: "http://192.168.0.165:3000/lista"  
            })
            .done(function( msg ) {
                let atendimentoobj = msg.atendimentos;
                atendimentoobj.forEach(element => {
                    $("#lista").append(`
                    <div atd="${element.id}" class="atendimento">
                        <div class="secUnSol">
                            <h4>Id: <span>${element.id}</span> | ${element.date}</h2>
                            <ul class="menu">
                                <li>Editar</li>
                                <li>Remover</li>
                            </ul>
                        </div>
                        <div class="secUnSol">
                            <h4>Unidade: <span>${element.unidade.toUpperCase()}</span></h2>
                            <h4>Solicitante: <span>${element.solicitante}</span></h2> 
                        </div>
                        <hr>
                        <h4>Descrição</h4>
                        <p>${element.descricao}</p>
                    </div>
                    `);
                });
                let numAtende = msg.numeroatendimentos;
                for (let obj in numAtende) {
                    $("#numAtendimentos").children("ul").append(`
                        <li>${obj.toUpperCase()+": "+numAtende[obj]}
                    `);
                }
            });
        };
    </script>
</body>
</html>